package cfig.p2psniper.ppdsdk

import org.junit.Before
import org.junit.Test
import org.slf4j.LoggerFactory

class PpdDebtTest {
    private val log = LoggerFactory.getLogger(PpdClientTest::class.java)
    private val privk = String(this::class.java.classLoader.getResourceAsStream("p2psniper_privk").readBytes())
    private val pubk = String(this::class.java.classLoader.getResourceAsStream("p2psniper_pubk").readBytes()).trim()
    private var appId = String(this::class.java.classLoader.getResourceAsStream("p2psniper_appid").readBytes()).trim()
    private val currentAccessToken = String(this::class.java.classLoader.getResourceAsStream("currentAccessToken").readBytes()).trim()
    private val currentOpenID = String(this::class.java.classLoader.getResourceAsStream("currentOpenID").readBytes()).trim()
    private val currentRefToken = String(this::class.java.classLoader.getResourceAsStream("currentRefToken").readBytes()).trim()

    private lateinit var sniperClient: PpdClient

    @Before
    fun setUp() {
        sniperClient = PpdClient(PpdApp(appId, pubk, privk, ""))
    }

    @Test
    fun debtListTest() {
        sniperClient.debtService.debtListSecondsAgo(60)
        //{"Count":38,"DebtInfos":[{"CreditCode":"AA","DebtdealId":200981738,"ListingId":307531180,"OwingNumber":8,"PriceforSale":446.09,"PriceforSaleRate":8.5},{"CreditCode":"AA","DebtdealId":200981737,"ListingId":304395404,"OwingNumber":7,"PriceforSale":391.06,"PriceforSaleRate":8.5},{"CreditCode":"AA","DebtdealId":200981736,"ListingId":144468332,"OwingNumber":3,"PriceforSale":252.7,"PriceforSaleRate":8.5},{"CreditCode":"AA","DebtdealId":200981735,"ListingId":144467206,"OwingNumber":3,"PriceforSale":252.7,"PriceforSaleRate":8.5},{"CreditCode":"AA","DebtdealId":200981734,"ListingId":144467086,"OwingNumber":3,"PriceforSale":252.69,"PriceforSaleRate":8.5},{"CreditCode":"AA","DebtdealId":200981733,"ListingId":144466901,"OwingNumber":3,"PriceforSale":252.69,"PriceforSaleRate":8.5},{"CreditCode":"AA","DebtdealId":200981732,"ListingId":144438852,"OwingNumber":6,"PriceforSale":337.13,"PriceforSaleRate":9},{"CreditCode":"AA","DebtdealId":200981731,"ListingId":144435376,"OwingNumber":3,"PriceforSale":252.7,"PriceforSaleRate":8.5},{"CreditCode":"AA","DebtdealId":200981729,"ListingId":144428468,"OwingNumber":6,"PriceforSale":337.12,"PriceforSaleRate":9},{"CreditCode":"AA","DebtdealId":200981694,"ListingId":308916853,"OwingNumber":5,"PriceforSale":41.73,"PriceforSaleRate":8},{"CreditCode":"AA","DebtdealId":200981693,"ListingId":308781051,"OwingNumber":5,"PriceforSale":41.74,"PriceforSaleRate":8},{"CreditCode":"AA","DebtdealId":200981692,"ListingId":308477676,"OwingNumber":5,"PriceforSale":41.76,"PriceforSaleRate":8},{"CreditCode":"AA","DebtdealId":200981691,"ListingId":308161436,"OwingNumber":5,"PriceforSale":41.78,"PriceforSaleRate":8},{"CreditCode":"AA","DebtdealId":200981690,"ListingId":308149707,"OwingNumber":5,"PriceforSale":41.78,"PriceforSaleRate":8},{"CreditCode":"AA","DebtdealId":200981689,"ListingId":308058971,"OwingNumber":5,"PriceforSale":41.77,"PriceforSaleRate":8},{"CreditCode":"AA","DebtdealId":200981688,"ListingId":308025951,"OwingNumber":5,"PriceforSale":41.78,"PriceforSaleRate":8},{"CreditCode":"AA","DebtdealId":200981687,"ListingId":307896321,"OwingNumber":5,"PriceforSale":41.79,"PriceforSaleRate":8},{"CreditCode":"AA","DebtdealId":200981686,"ListingId":307851257,"OwingNumber":5,"PriceforSale":41.8,"PriceforSaleRate":8},{"CreditCode":"AA","DebtdealId":200981685,"ListingId":307815581,"OwingNumber":5,"PriceforSale":41.8,"PriceforSaleRate":8},{"CreditCode":"AA","DebtdealId":200981684,"ListingId":307801578,"OwingNumber":5,"PriceforSale":41.8,"PriceforSaleRate":8},{"CreditCode":"AA","DebtdealId":200981683,"ListingId":307792574,"OwingNumber":5,"PriceforSale":41.8,"PriceforSaleRate":8},{"CreditCode":"AA","DebtdealId":200981679,"ListingId":302124718,"OwingNumber":4,"PriceforSale":33.63,"PriceforSaleRate":8.5},{"CreditCode":"AA","DebtdealId":200981677,"ListingId":300347269,"OwingNumber":4,"PriceforSale":33.75,"PriceforSaleRate":8.5},{"CreditCode":"AA","DebtdealId":200981676,"ListingId":145261281,"OwingNumber":4,"PriceforSale":33.74,"PriceforSaleRate":8.5},{"CreditCode":"AA","DebtdealId":200981675,"ListingId":145261112,"OwingNumber":4,"PriceforSale":33.75,"PriceforSaleRate":8.5},{"CreditCode":"AA","DebtdealId":200981674,"ListingId":145260956,"OwingNumber":4,"PriceforSale":33.75,"PriceforSaleRate":8.5},{"CreditCode":"AA","DebtdealId":200981673,"ListingId":145260873,"OwingNumber":4,"PriceforSale":33.74,"PriceforSaleRate":8.5},{"CreditCode":"AA","DebtdealId":200981664,"ListingId":305587256,"OwingNumber":7,"PriceforSale":39,"PriceforSaleRate":8.5},{"CreditCode":"AA","DebtdealId":200981663,"ListingId":305450918,"OwingNumber":7,"PriceforSale":39.04,"PriceforSaleRate":8.5},{"CreditCode":"AA","DebtdealId":200981662,"ListingId":304106463,"OwingNumber":7,"PriceforSale":39.11,"PriceforSaleRate":8.5},{"CreditCode":"AA","DebtdealId":200981660,"ListingId":303961000,"OwingNumber":7,"PriceforSale":39.15,"PriceforSaleRate":8.8},{"CreditCode":"AA","DebtdealId":200981659,"ListingId":303900619,"OwingNumber":7,"PriceforSale":39.14,"PriceforSaleRate":8.8},{"CreditCode":"AA","DebtdealId":200981658,"ListingId":303900601,"OwingNumber":7,"PriceforSale":39.15,"PriceforSaleRate":8.8},{"CreditCode":"AA","DebtdealId":200981657,"ListingId":303900513,"OwingNumber":7,"PriceforSale":39.15,"PriceforSaleRate":8.8},{"CreditCode":"AA","DebtdealId":200981656,"ListingId":303900506,"OwingNumber":7,"PriceforSale":39.14,"PriceforSaleRate":8.8},{"CreditCode":"AA","DebtdealId":200981655,"ListingId":303618812,"OwingNumber":7,"PriceforSale":39.16,"PriceforSaleRate":8.8},{"CreditCode":"AA","DebtdealId":200981654,"ListingId":303550440,"OwingNumber":7,"PriceforSale":39.16,"PriceforSaleRate":8.8},{"CreditCode":"AA","DebtdealId":200981653,"ListingId":303193900,"OwingNumber":6,"PriceforSale":33.46,"PriceforSaleRate":8.8}],"Result":1,"ResultCode":null,"ResultMessage":"成功"}
    }

    @Test
    fun debtDetailTest() {
        sniperClient.debtService.debtDetail(listOf(200981738, 200981737, 200981736))
        //{"DebtInfos":[{"AllowanceRadio":0,"BidDateTime":"2019-01-14T20:52:21.257","CreditCode":"AA","CurrentCreditCode":"AA","Days":29,"DebtId":200981736,"Lender":"pdu1507857167","ListingAmount":6000,"ListingId":144468332,"ListingMonths":6,"ListingRate":8.5,"ListingTime":"2019-01-14T20:49:24.127","OwingInterest":3.58,"OwingNumber":3,"OwingPrincipal":252.65,"PastDueDay":0,"PastDueNumber":0,"PreferenceDegree":0,"PriceforSale":252.7,"PriceforSaleRate":8.5,"Seller":"pdu1507857167","StatusId":1},{"AllowanceRadio":0,"BidDateTime":"2019-02-21T20:42:32.713","CreditCode":"AA","CurrentCreditCode":"AA","Days":36,"DebtId":200981737,"Lender":"pdu1507857167","ListingAmount":9100,"ListingId":304395404,"ListingMonths":9,"ListingRate":8.5,"ListingTime":"2019-02-21T19:42:09.633","OwingInterest":11.17,"OwingNumber":7,"OwingPrincipal":391.62,"PastDueDay":0,"PastDueNumber":0,"PreferenceDegree":0,"PriceforSale":391.06,"PriceforSaleRate":8.5,"Seller":"pdu1507857167","StatusId":2},{"AllowanceRadio":0,"BidDateTime":"2019-03-14T17:01:22.610","CreditCode":"AA","CurrentCreditCode":"AA","Days":29,"DebtId":200981738,"Lender":"pdu1507857167","ListingAmount":11000,"ListingId":307531180,"ListingMonths":9,"ListingRate":8.5,"ListingTime":"2019-03-14T16:57:43.120","OwingInterest":14.32,"OwingNumber":8,"OwingPrincipal":446,"PastDueDay":0,"PastDueNumber":0,"PreferenceDegree":0,"PriceforSale":446.09,"PriceforSaleRate":8.5,"Seller":"pdu1507857167","StatusId":1}],"Result":1,"ResultCode":null,"ResultMessage":"成功"}
    }
}
